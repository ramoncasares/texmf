% RCstyle.tex (20141204)

\ifx\files\undefined \input indexes \fi

\files

% Fonts

\ifx\loadfont\undefined \input fonts \fi
\xiifonts \xiititles \rm
\let\bold=\xiibfonts \let\roman=\xiifonts
\out{tex}\utfon
\font\sf=cmss12
\font\sfit=cmssi12

\catcode`\@=11

\font\xiiex=cmex10 at12pt
\textfont3=\xiiex \scriptfont3=\xiiex \scriptscriptfont3=\xiiex

\font\xiibb=msbm10 at12pt
\font\ixbb=msbm9
\font\vibb=msbm6
\newfam\bbfam % fam 8
\textfont\bbfam=\xiibb \scriptfont\bbfam=\ixbb
\scriptscriptfont\bbfam=\vibb
\def\bb{\fam\bbfam\xiibb}
%\mathchardef\beth="0869
\mathchardef\subsetneq="3828

\font\xiifrak=eufm10 at12pt
\font\ixfrak=eufm9
\newfam\frakfam \textfont\frakfam=\xiifrak \scriptfont\frakfam=\ixfrak
\def\frak{\fam\frakfam\xiifrak}

\mathcode`?="603F % ? works as punctuation
\def\ifmath$#1${\relax\ifmmode #1\else$#1$\fi}
\def\QED{\ifmath$\diamond$}

% Layout

\ifcase\pdfoutput
 \special{papersize=210mm,297mm}
\else
 \pdfcompresslevel=9
 \pdfdecimaldigits=4
 \pdfhorigin=1truein
 \pdfvorigin=1truein
 \pdfpageheight=297truemm
 \pdfpagewidth=210truemm
\fi
\hsize=15.92truecm \vsize=24.62truecm % DIN A4
\advance\vsize -30pt

\def\twodigits#1{\ifnum #1<10 0\fi \number#1}
\def\todayiso{\number\year \twodigits\month \twodigits\day}
\let\version=\todayiso
\def\Folio{\ifnum\pageno<0
 \uppercase\expandafter{\romannumeral-\pageno}\else\number\pageno\fi}

\headline={\vrule height10.2pt depth4.2pt width0pt
 {\xiitt www.ramoncasares.com}\quad{\xiirm\version}\hfil
 \quad{\xiibf\jobname\quad\Folio}}%
\def\makeheadline{\vbox to 30pt{\colorblack\line{\the\headline}%
  \kern 1pt \hrule height 1pt\vfil\endcolor}\nointerlineskip}
\nopagenumbers

% Sectioning

\newcount\secno
\newcount\ssecno
\newcount\thno
\newcount\parno
\let\presec=\empty
\def\presec{^^c2^^a7}% \S comment out for an empty one

\parskip=0pt plus 1pt
\newdimen\oldparindent \oldparindent=20pt \parindent=0pt
\def\hang{\hangindent\oldparindent}

\def\numberedpars{\global\advance\parno1 %\dest
 \noindent\hbox to\oldparindent{{\xiiscriptsy\char123
  \xiiscriptrm\number\parno}\hfil$\cdot$\hfil}\ignorespaces}
\def\continuepar{{\everypar{}\par\noindent}\hangindent0pt\ignorespaces}

\def\begincenter{\par\begingroup \parindent=0pt
 \advance\leftskip 0pt plus 1fill \advance\rightskip 0pt plus 1fill
 \def\\{\unskip\break\ignorespaces}}
\def\endcenter{\par\endgroup}

\let\n@xtlbl=\relax
\def\labeled#1{\def\n@xtlbl{#1}}

\outer\def\section#1{\vskip0pt plus 90pt\penalty-500\vskip0pt plus-90pt
 \goodbreak\vskip 2pc plus 1pc minus 3pt
 \ifx\n@xtlbl\relax \def\1{#1}\else\let\1=\n@xtlbl \let\n@xtlbl=\relax \fi
 \everypar{}\advance\secno1
 \ssecno=0 \thno=0 \parno=0
 \def\secid{\presec\the\secno}\noindent\dest
 {\setbox2=\hbox{\fonttwo\secid\enspace}\hangindent\wd2
  \rightskip=0pt plus 6em
  \fonttwo\secid\enspace#1\toc1{#1}\lbl{\1}{#1}\par}
 \everypar{\numberedpars}}

\outer\def\xsection#1{\vskip0pt plus 90pt\penalty-500\vskip0pt plus-90pt
 \goodbreak\vskip 2pc plus 1pc
 \ifx\n@xtlbl\relax \def\1{#1}\else\let\1=\n@xtlbl \let\n@xtlbl=\relax \fi
 \everypar{}\parno=0
 \def\secid{}\noindent\dest
 {\rightskip=0pt plus 6em
  \fonttwo#1\toc1{#1}\lbl{\1}{#1}\par}}

\outer\def\subsection#1{\vskip0pt plus 60pt\penalty-250\vskip0pt plus-60pt
 \ifnum\parno=0 \vskip 0.5pc plus 3pt minus 3pt\else\vskip 1pc plus 6pt minus 6pt\fi
 \ifx\n@xtlbl\relax \def\1{#1}\else\let\1=\n@xtlbl \let\n@xtlbl=\relax \fi
 \everypar{}\advance\ssecno1 \thno=0 \parno=0
 \def\secid{\presec\the\secno.\the\ssecno}\noindent\dest
 {\setbox2=\hbox{\fontthree\secid\enspace}\hangindent\wd2
  \rightskip=0pt plus 6em
 \fontthree\secid\enspace#1\toc2{#1}\lbl{\1}{#1}\par}
 \everypar{\numberedpars}}

\outer\def\xsubsection#1{\vskip0pt plus 60pt\penalty-250\vskip0pt plus-60pt
 \ifnum\parno=0 \vskip 0.5pc plus 3pt minus 3pt\else\vskip 1pc plus 6pt minus 6pt\fi
 \ifx\n@xtlbl\relax \def\1{#1}\else\let\1=\n@xtlbl \let\n@xtlbl=\relax \fi
 \toks0=\everypar \everypar{}\def\secid{}\noindent\dest
 {\rightskip=0pt plus 6em
  \fontthree#1\toc2{#1}\lbl{\1}{#1}\par}
 \everypar=\toks0}

\outer\def\clause#1{\vskip0pt plus 30pt\penalty-150\vskip0pt plus-30pt
 \everypar{}\medskip\hang\noindent
 \advance\thno1 \def\secid{\presec\the\secno.\the\ssecno.\the\thno}%
 {\sc\secid\ #1}\quad\ignorespaces}
\outer\def\comment#1{\everypar{}\par
 \hang\noindent{\sc #1}\quad\ignorespaces}

% Openings

\def\title#1{\def\titledoc{#1}}
\def\author#1{\def\authordoc{#1}}
\def\keywords#1{\def\keywordsdoc{#1}}
\def\subject#1{\def\subjectdoc{#1}}
\def\contact#1{\def\contactdoc{#1}}

\def\beginnote{\insert\footins\bgroup\continuepar\strut\colorblack}
\def\endnote{\endcolor\egroup}

\def\infodoc{\begingroup
  \def~{ }\def\\{ }\def\S{^^a7}\let\-\relax \stringaccents
  \deactivatehigh \utfon\out{pdf}\let^^e2=\@eii \doextrapdf
  \ifcase\pdfoutput
   \ifx\dvips\undefined
    \special{pdf: docinfo <<
     /Title (\titledoc) /Author (\authordoc)
     /Keywords (\keywordsdoc) /Subject (\subjectdoc) >>}%
   \else
    \special{ps: [
     /Title (\titledoc) /Author (\authordoc)
     /Keywords (\keywordsdoc) /Subject (\subjectdoc)
     /DOCINFO pdfmark }%
   \fi
  \else
   \pdfinfo{/Title (\titledoc) /Author (\authordoc)
     /Keywords (\keywordsdoc) /Subject (\subjectdoc)}\fi
 \endgroup}

\def\maketitle{\par \infodoc
 \null\vskip 3pc plus 4pc minus 1pc
 \def\secid{}\dest\toc0{\titledoc}\lbl{\titledoc}{}
 \begincenter \fontzero\titledoc \endcenter
 \vskip 1pc plus 1pc
 \centerline{\fontone\authordoc}
 \ifx\contactdoc\undefined\else
  \vskip 6pt minus 3pt
  \centerline{\rm\contactdoc}\fi
 \vskip 2pc plus 1pc minus 1pc\relax}

\def\beginabstract{\begingroup \parindent=55pt\narrower \sl\parindent=20pt\noindent}
\def\endabstract{\par \ifx\keywordsdoc\undefined\else \sfit\rightskip=55pt plus3em
 \smallskip\setbox0=\hbox{Keywords:\quad}\hangindent\wd0
 \noindent\box0\keywordsdoc\par\fi \smallskip\endgroup}

% References

%% \cite Post (1944) -> Post (1944)
%% \cite* Post (1944) -> Post 1944
%% \cite[free \1's text \2] Post (1944) -> free Post's text 1944

\def\citenone #1 (#2){\ref{#1#2}}
\def\citetext [#1] #2 (#3){\refx{{\def\1{#2}\def\2{#3}#1}}{#2#3}}
\def\citestar * #1 (#2){\refx{#1\ #2}{#1#2}}

\def\cite{\futurelet\nexttoken\citexx}
\def\citexx{\if *\nexttoken \let\next=\citestar \else
 \if [\nexttoken \let\next=\citetext \else
 \let\next=\citenone \fi\fi\next}

\def\chreference #1 (#2){\everypar{}\par
 \vskip0pt plus 2\baselineskip\penalty-43
 \vskip0pt plus-2\baselineskip
 \noindent\hangindent20pt\relax
 #1\thinspace(#2)\dest\lbl{#1#2}{#1\ (#2)}}

\def\brreference #1 (#2){\everypar{}\par
 \vskip0pt plus 2\baselineskip\penalty-43
 \vskip0pt plus-2\baselineskip
 \noindent\hangindent20pt\relax
 [#1 #2]\dest\lbl{#1#2}{[#1 #2]}}

\let\reference=\chreference
\let\biblabel=\chreference

\def\references{\vskip0pt plus 90pt\penalty-500\vskip0pt plus-90pt
 \everypar{}\parno=0
 \goodbreak\vskip 2pc plus 1pc
 \def\secid{}
 \noindent{\fonttwo References\dest\toc1{References}\lbl{References}{}}\par
 \begingroup
  \catcode`\_=13
  \def\biblabel ##1 ({{\stringaccents\def\&{\string\&}\xdef\1{##1}}\next}
  \def\next ##1) ##2\par{
    \expandafter\gdef\csname \1##1\endcsname{##2}}
  \input RCbiblio
 \let\item=\bibitem \let\xitem=\xbibitem
 \everypar{}\smallskip \parskip=0pt \frenchspacing}
\def\endreferences{\par\endgroup}

\def\bibitem #1 (#2){\chreference #1 (#2):\enskip
 {\stringaccents\def\&{\string\&}\xdef\1{#1}}\csname \1#2\endcsname}
\def\xbibitem #1 (#2) = #3 (#4){\chreference #1 (#2):\enskip
 {\stringaccents\def\&{\string\&}\xdef\1{#3}}\csname \1#4\endcsname}

\def\book#1{{\em#1}}
\def\article#1{“#1”}
\def\articlede#1{„#1“}
\def\periodical#1{{\em#1}}
\def\ISBN{{\sc isbn: }}
\def\oldDOI#1{{\sc doi: }\URL{#1}<https://dx.doi.org/#1>}
\def\DOIx#1#2{{\sc doi: }\URL{#1}<#2>}

% Protecting underscores

\catcode`\_12 \def\@nder{_} \catcode`\_13

\def\DOI{{\sc doi: }\begingroup\catcode`\_=13\relax\d@i}
\def\d@i#1{\edef\1{#1}\relax\let_\@nder\relax\edef\2{\1<https://doi.org/#1>}%
 \expandafter\URL\2\endgroup}

\def\URL#1<{\leavevmode\begingroup\def\1{#1}\catcode`\#=12\catcode`\_=13\relax\@RL}
\def\@RL#1>{\let_\@nder\ifx\1\empty\def\2{#1}\else\def\2{\1}\fi
\ifcase\pdfoutput
 \ifx\dvips\undefined
  \special{pdf: bann << /Type /Annot /Subtype /Link /Border [0 0 0]
  /A << /Type /Action /S /URI /URI (#1) >> >>}{\color{Red}\2\endcolor}\special{pdf: eann}\else
  \special{html:<a href=\string"#1\string">}{\color{Red}\2\endcolor}\special{html:</a>}%
\fi
\else
 \pdfstartlink attr{/Border [0 0 0]}
  user{/Subtype /Link /A << /Type /Action
  /S /URI /URI (#1) >>}{\color{Red}\2\endcolor}\pdfendlink
\fi\endgroup\relax}

\catcode`\_=8

% Table of contents

%\tocline{1 level}{2 text}{3 label}{4 secid}{5 page}

\newdimen\tochsize \tochsize=\hsize \advance\tochsize-5\baselineskip
\newdimen\tocindent \tocindent=2\baselineskip % so leaders get aligned
\def\tocbox{\hbox to\tocindent}

\def\leaderfill{\leaders\hbox to\baselineskip{\hss.\hss}\hfill}
\def\unfakeablepar{\unskip\nobreak
 \leaders\hbox to\baselineskip{\hss.\hss}\hskip\parfillskip
 \vadjust{}{\parfillskip=-\baselineskip\endgraf}}

% Hierarchical
\def\toclineX#1#2#3#4#5{\count@=#1\def\0{#4}%
 \ifx\0\star \csname#2\endcsname \else
 \ifx\0\lq \relax \else
 \ifx\0\rq \lrelax \else
 \ifx\0\empty \let\0=\ignorespaces \else
 \ifx\0\lbrack \let\0=\ignorespaces \else
 \ifx\0\rbrack \let\0=\ignorespaces \else
 \def\0{\tocbox{#4\hfil}}\fi\fi\fi
 \setbox0=\hbox{\kern\count@\tocindent\0#2}%
 \ifdim\wd0>\tochsize \advance\count@1
  \line{\vbox{\hsize=\tochsize \rightskip=0pt plus6em
   \hangindent\count@\tocindent \noindent\strut
    \kern#1\tocindent\0#2\strut\unfakeablepar}\leaderfill
  {\xiibf\goto{#5}{#3}}}%
 \else
  \line{\strut\kern#1\tocindent\0#2\leaderfill {\xiibf\goto{#5}{#3}}}%
 \fi
 \fi\fi\fi}

% Centered
\def\toclineC#1#2#3#4#5{\def\0{#4}%
 \ifx\0\star \csname#2\endcsname \else
 \ifx\0\lq \relax \else
 \ifx\0\rq \lrelax \else
 \ifx\0\empty \let\0=\ignorespaces \else
 \ifx\0\lbrack \let\0=\ignorespaces \else
 \ifx\0\rbrack \let\0=\ignorespaces \fi\fi\fi
 \begincenter\goto{\0 #2}{#3}\endcenter
 \fi\fi\fi}

% RMCG default (0 centered, 1 left, 2 indent (only numbered), 3+ ignored
\def\toclineR#1#2#3#4#5{\ifcase#1
  \bigbreak{\fonttwo\toclineC{#1}{#2}{#3}{#4}{#5}}\medskip\or
  \toclineX{0}{#2}{#3}{#4}{#5}\or
  \def\0{#4}\ifx\0\empty\else \toclineX{1}{#2}{#3}{#4}{#5}\fi
  \else\relax\fi}

\let\tocline=\toclineR

\newread\tocfile
\def\maketoc{\openin\tocfile=auxiliar.toc
 \ifeof\tocfile
  \closein\tocfile
  \message{No toc file!}%
 \else
  \closein\tocfile
  \dest\let\secid\lq\toc1{Contents}%
  \tochsize=\hsize \advance\tochsize-5\baselineskip
  \input auxiliar.toc
 \fi}

% Differences

% The TeX Book Exercise 14.28
\def\strutdepth{\dp\strutbox}
\def\marginalstar{\strut\vadjust{\kern-\strutdepth\specialstar}}
\let\marginalsymbol=*
\def\specialstar{\vtop to \strutdepth{
 \baselineskip\strutdepth
 \vss\llap{\rm\truecolor{Red}\marginalsymbol\endcolor\quad}\null}}

\def\new/{\truecolor{Red}}
\def\wen/{\endcolor\ifhmode\marginalstar\fi}

\def\uncatcodespecials{\def\do##1{\catcode`##1=12 }\dospecials}
\def\del/{\begingroup\uncatcodespecials
 \ifvmode \let\next=\DELv \else \let\next=\DELh \fi\next}
{\catcode`\|=0 \catcode`\\=12
 |long|gdef|DELv#1\led/{|endgroup}
 |long|gdef|DELh#1\led/{|marginalstar|endgroup|ignorespaces}}
\def\led/{\errmessage{Error! Unnested led.}}

% Verbatim

% \verb<char><text><char> writes <text> verbatim

\def\uncatcodespecials{\def\do##1{\catcode`##1=12 }\dospecials}

\def\verb{\begingroup\setupverbatim\d@verbatim}
\def\setupverbatim{\tt\parskip0pt plus0.1pt minus0.1pt
 \everypar={}\def\par{\leavevmode\endgraf}\catcode`\`=13
 \uccode`\~=`\ \uppercase{\let~=\ }\uccode`\~=`\`
 \uppercase{\def~{\relax\lq}}\uccode`\~=0
 \obeylines\uncatcodespecials\obeyspaces \verbatimoptions}
\def\d@verbatim#1{\def\next##1#1{##1\endgroup}\next}
\def\verbatimoptions{}
{\catcode`\`=13 \gdef`{\lq}} % [228], [254]
% From ``The \TeX book'', pg 380--382
%  For line numbering do:
%    \def\verbatimoptions{\parindent=60pt
%     \everypar{\llap{\sevenrm\the\inputlineno\quad}}}
%  For an escape character do:
%    \def\verbatimoptions{\catcode`\\=0 }
%  For minimal markup do:
%    \catcode`\"=13 \def"{\verb"}

% Misc

\def\newline{\ifvmode\null\else\null\hfil\break\fi}
\let\\=\newline

\def\beginpoints{\begingroup\parskip=0pt\parindent=20pt\everypar{}}
%\def\point{\item{$\circ$}}
\def\point{\futurelet\nexttoken\pointxx}
\def\pointxx{\if [\nexttoken \let\next=\namedpoint \else \let\next=\defaultpoint \fi\next}
\def\namedpoint[#1]{\setbox0=\hbox{#1}\ifdim\wd0<\parindent \item{#1}\else \par\hang\noindent{#1}\fi}
\def\defaultpoint{\item{$\circ$}}
\def\endpoints{\par\noindent\endgroup}

\def\begincitation{\smallskip\begingroup\everypar={}\sl
 \advance\leftskip20pt\advance\rightskip20pt}
\def\endcitation{\smallskip\noindent\endgroup}

\def\needspace#1{\vskip0pt plus #1\penalty-250\vskip0pt plus -#1\relax}

% Emphasis with automatic italic correction (\/).
% Use: {\em italic}, {\qt slanted}.
\def\em{\ifdim \fontdimen1\font=0pt \aftergroup\smartitc@r \fi \it}
\def\qt{\ifdim \fontdimen1\font=0pt \aftergroup\smartitc@r \fi \sl}
\def\smartitc@r{\ifhmode \expandafter\itpuncl@ok \fi}
\def\itpuncl@ok{\begingroup\futurelet\ITCt@mpa\itcort@st}
\def\itcort@st{\def\ITCt@mpb{\ITCt@mpa}%
 \ifcat\noexpand\ITCt@mpa,\setbox0=\hbox{\ITCt@mpb}%
  \ifdim\ht0<0.3ex \let\itc@rdo=\endgroup \fi\fi \itc@rdo}
\def\itc@rdo{\skip0=\lastskip \ifdim\skip0=0pt \/\else
 \unskip \/\hskip\skip0 \fi \endgroup}

\def\definition#1{{\em #1}}
\def\latin#1{{\em #1}}
\def\person#1{{#1}}

\def\MTfigures{\ifx\MT\undefined \input metatex \fi
 \let\MTbeginfig=\MTbeginchar \let\MTendfig=\MTendchar % to fool arXiv AutoTeX
 \MTline{if known prologues:} % if mpost:
 \MTline{ verbatimtex}
 \MTline{ \\input fonts \\xiifonts}
 \MTline{ \\catcode`\\@=11} % because in plain.fmt \cal -> \fam\tw@
 \MTline{ etex}
 \MTline{fi}
 \MTline{}}

\catcode`\@=12
